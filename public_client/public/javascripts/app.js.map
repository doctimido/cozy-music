{"version":3,"file":"public/javascripts/app.js","sources":["app/application.coffee","app/initialize.coffee","app/lib/app_helpers.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7HA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhBA;;A","sourcesContent":["var Application,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\nmodule.exports = Application = (function() {\n  function Application() {\n    this.launchTimer = __bind(this.launchTimer, this);\n    this.resetTimer = __bind(this.resetTimer, this);\n    this.onMute = __bind(this.onMute, this);\n    this.onFinish = __bind(this.onFinish, this);\n    this.playSong = __bind(this.playSong, this);\n    this.getSongUrl = __bind(this.getSongUrl, this);\n    this.initialize = __bind(this.initialize, this);\n  }\n\n  Application.prototype.defaultVolume = 70;\n\n  Application.prototype.initialize = function() {\n    var title,\n      _this = this;\n    title = document.URL;\n    $('#title').html(\"<i class='icon-music'></i> \" + (title.replace(/\\/public\\/cozic\\/.*$/, '').replace(/^.*:\\/\\//, '')));\n    $('#mute-button').click(function(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      return _this.onMute();\n    });\n    this.soundManager = soundManager;\n    this.soundManager.setup({\n      debugMode: false,\n      debugFlash: false,\n      useFlashBlock: false,\n      preferFlash: true,\n      url: \"swf/\",\n      flashVersion: 9,\n      onready: function() {\n        $('#song-info').html(\"<i class='icon-cog'></i> Requesting server...\");\n        return _this.getSongUrl();\n      },\n      ontimeout: function() {\n        return $('#song-info').html(\"<i class='icon-exclamation-sign'></i> unable to load player\");\n      }\n    });\n    this.volume = this.defaultVolume;\n    this.prevSoundUrl = \"\";\n    return this.resetTimer();\n  };\n\n  Application.prototype.getSongUrl = function() {\n    var _this = this;\n    console.log(\"asking server...\");\n    return $.ajax(\"broadcast\", {\n      type: 'GET',\n      error: function(jqXHR, textStatus, errorThrown) {\n        return $('#song-info').html(\"<i class='icon-exclamation-sign'></i> \" + textStatus + \": \" + errorThrown);\n      },\n      success: function(data, textStatus, jqXHR) {\n        if (textStatus === \"nocontent\") {\n          $('#song-info').html(\"<i class='icon-stop'></i> No song to play yet\");\n          return _this.launchTimer();\n        } else {\n          if (data.url !== _this.prevSoundUrl) {\n            _this.playSong(data);\n            return _this.resetTimer();\n          } else {\n            $('#song-info').html(\"<i class='icon-stop'></i> No more song to play for now\");\n            return _this.launchTimer();\n          }\n        }\n      }\n    });\n  };\n\n  Application.prototype.playSong = function(data) {\n    this.prevSoundUrl = data.url;\n    this.currentSound = this.soundManager.createSound({\n      id: \"sound\",\n      url: data.url,\n      volume: this.volume,\n      autoPlay: true,\n      onfinish: this.onFinish\n    });\n    return $('#song-info').html(\"<i class='icon-play'></i>  \" + data.title + \" - <i>\" + data.artist + \"</i>\");\n  };\n\n  Application.prototype.onFinish = function() {\n    if (this.currentSound != null) {\n      this.currentSound.destruct();\n      this.currentSound = null;\n    }\n    $('#song-info').html(\"<i class='icon-stop'></i> Stopped\");\n    return this.getSongUrl();\n  };\n\n  Application.prototype.onMute = function() {\n    if (this.currentSound != null) {\n      if (this.volume === 0) {\n        this.currentSound.setVolume(this.defaultVolume);\n      } else {\n        this.currentSound.setVolume(0);\n      }\n    }\n    if (this.volume === 0) {\n      this.volume = this.defaultVolume;\n      return $('#mute-button').html(\"<i class='icon-volume-up'></i> mute\");\n    } else {\n      this.volume = 0;\n      return $('#mute-button').html(\"<i class='icon-volume-off'></i>&nbsp;&nbsp;unmute\");\n    }\n  };\n\n  Application.prototype.resetTimer = function() {\n    return this.timeToWait = 1;\n  };\n\n  Application.prototype.launchTimer = function() {\n    var _this = this;\n    setTimeout(function() {\n      return _this.getSongUrl();\n    }, this.timeToWait * 1000);\n    return this.timeToWait = this.timeToWait >= 32 ? 32 : this.timeToWait * 2;\n  };\n\n  return Application;\n\n})();\n","var Application;\n\nApplication = require('application');\n\n$(function() {\n  var app;\n  require('lib/app_helpers');\n  app = new Application();\n  return app.initialize();\n});\n","(function() {\n  return (function() {\n    var console, dummy, method, methods, _results;\n    console = window.console = window.console || {};\n    method = void 0;\n    dummy = function() {};\n    methods = 'assert,count,debug,dir,dirxml,error,exception,\\\n                   group,groupCollapsed,groupEnd,info,log,markTimeline,\\\n                   profile,profileEnd,time,timeEnd,trace,warn'.split(',');\n    _results = [];\n    while (method = methods.pop()) {\n      _results.push(console[method] = console[method] || dummy);\n    }\n    return _results;\n  })();\n})();\n"]}